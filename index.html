<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>é‰„å¡” æ®µå‰²ã‚Šè¨ˆç®—</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap');

:root {
â€“bg: #f0efe9;
â€“white: #ffffff;
â€“accent: #1a6b4a;
â€“accent-light: #e8f5ee;
â€“text: #1a1a1a;
â€“muted: #999;
â€“border: #e0e0d8;
â€“radius: 14px;
}

- { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
height: 100%;
overflow: hidden;
background: var(â€“bg);
color: var(â€“text);
font-family: â€˜Noto Sans JPâ€™, sans-serif;
font-weight: 300;
}

/* â”€â”€â”€ å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ â”€â”€â”€ */
.layout {
display: flex;
height: 100dvh;
overflow: hidden;
}

/* å·¦ï¼šå…¥åŠ›ãƒ‘ãƒãƒ«ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ï¼‰ */
.panel-left {
width: 55%;
display: flex;
flex-direction: column;
overflow: hidden;
border-right: 1px solid var(â€“border);
}

.panel-header {
padding: 14px 20px 10px;
flex-shrink: 0;
border-bottom: 1px solid var(â€“border);
background: var(â€“white);
}
.panel-header h1 {
font-size: 1.05rem;
font-weight: 700;
color: var(â€“accent);
}
.panel-header p {
font-size: 0.72rem;
color: var(â€“muted);
margin-top: 2px;
}

.scroll-area {
flex: 1;
overflow-y: auto;
padding: 14px 16px 40px;
-webkit-overflow-scrolling: touch;
}

/* å³ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« */
.panel-right {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: space-between;
padding: 16px 12px;
background: var(â€“white);
overflow: hidden;
}

.preview-label {
font-size: 0.68rem;
font-weight: 700;
color: var(â€“muted);
letter-spacing: 0.1em;
text-transform: uppercase;
}

#cv {
border-radius: 10px;
background: #f0f0ea;
max-height: calc(100dvh - 100px);
width: 100%;
max-width: 280px;
object-fit: contain;
}

.save-btn {
width: 100%;
max-width: 280px;
padding: 14px;
background: var(â€“accent);
color: #fff;
border: none;
border-radius: 12px;
font-family: inherit;
font-size: 0.9rem;
font-weight: 700;
cursor: pointer;
transition: opacity 0.2s;
}
.save-btn:active { opacity: 0.7; }

/* â”€â”€â”€ ã‚«ãƒ¼ãƒ‰ â”€â”€â”€ */
.card {
background: var(â€“white);
border-radius: var(â€“radius);
padding: 16px;
margin-bottom: 12px;
box-shadow: 0 1px 5px rgba(0,0,0,0.06);
}

.card-title {
font-size: 0.68rem;
font-weight: 700;
color: var(â€“muted);
letter-spacing: 0.1em;
text-transform: uppercase;
margin-bottom: 14px;
}

.section-label {
font-size: 0.75rem;
color: var(â€“muted);
margin: 14px 0 10px;
padding-bottom: 4px;
border-bottom: 1px solid var(â€“border);
}
.section-label:first-child { margin-top: 0; }

/* â”€â”€â”€ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆãƒ©ãƒ™ãƒ«ï¼‹æ•°å€¤ï¼‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼‰ â”€â”€â”€ */
.field { margin-bottom: 16px; }

.field-top {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 8px;
}

.field-top label {
flex: 1;
font-size: 0.88rem;
color: var(â€“text);
line-height: 1.3;
}

.num-wrap {
display: flex;
align-items: center;
gap: 4px;
flex-shrink: 0;
}

input[type=â€œnumberâ€] {
width: 80px;
font-size: 1.15rem;
font-weight: 700;
color: var(â€“accent);
border: 2px solid var(â€“border);
border-radius: 10px;
padding: 8px 10px;
outline: none;
background: var(â€“white);
-webkit-appearance: none;
appearance: none;
text-align: right;
transition: border-color 0.2s;
}
input[type=â€œnumberâ€]:focus {
border-color: var(â€“accent);
background: var(â€“accent-light);
}

.unit {
font-size: 0.82rem;
color: var(â€“muted);
min-width: 24px;
}

/* â”€â”€â”€ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ â”€â”€â”€ */
input[type=â€œrangeâ€] {
width: 100%;
height: 6px;
-webkit-appearance: none;
appearance: none;
background: var(â€“border);
border-radius: 3px;
outline: none;
cursor: pointer;
}
input[type=â€œrangeâ€]::-webkit-slider-thumb {
-webkit-appearance: none;
width: 32px;
height: 32px;
border-radius: 50%;
background: var(â€“accent);
border: 4px solid var(â€“white);
box-shadow: 0 2px 6px rgba(0,0,0,0.25);
cursor: pointer;
}

/* â”€â”€â”€ ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ â”€â”€â”€ */
.btn-row {
display: flex;
gap: 8px;
margin-bottom: 10px;
}

.tog-btn {
flex: 1;
padding: 12px 8px;
border-radius: 10px;
border: 2px solid var(â€“border);
background: var(â€“white);
font-family: inherit;
font-size: 0.82rem;
color: var(â€“muted);
cursor: pointer;
text-align: center;
transition: all 0.15s;
font-weight: 400;
line-height: 1.3;
}
.tog-btn.active {
border-color: var(â€“accent);
background: var(â€“accent-light);
color: var(â€“accent);
font-weight: 700;
}

.hint {
font-size: 0.7rem;
color: var(â€“muted);
line-height: 1.5;
margin-top: 4px;
margin-bottom: 8px;
}

/* â”€â”€â”€ çµæœ â”€â”€â”€ */
.seg-list { display: flex; flex-direction: column; gap: 7px; }

.seg-item {
display: flex;
align-items: center;
gap: 10px;
background: var(â€“bg);
border-radius: 10px;
padding: 9px 12px;
}
.seg-label {
font-size: 0.75rem;
color: var(â€“muted);
width: 60px;
flex-shrink: 0;
}
.seg-value {
font-size: 1.05rem;
font-weight: 700;
color: var(â€“accent);
width: 68px;
text-align: right;
flex-shrink: 0;
}
.seg-unit {
font-size: 0.72rem;
color: var(â€“muted);
flex-shrink: 0;
}
.seg-bar-wrap {
flex: 1;
background: var(â€“border);
border-radius: 4px;
height: 8px;
overflow: hidden;
}
.seg-bar {
height: 100%;
border-radius: 4px;
background: linear-gradient(90deg, var(â€“accent), #4aaa80);
transition: width 0.2s;
}

.total-row {
display: flex;
justify-content: flex-end;
font-size: 0.78rem;
color: var(â€“muted);
margin-top: 8px;
padding-top: 8px;
border-top: 1px solid var(â€“border);
}
.total-row span { color: var(â€“accent); font-weight: 700; margin-left: 4px; }

.error {
font-size: 0.8rem;
color: #c0392b;
padding: 8px 12px;
background: #fdecea;
border-radius: 8px;
display: none;
margin-bottom: 8px;
}
</style>

</head>
<body>

<div class="layout">

  <!-- â”€â”€â”€ å·¦ãƒ‘ãƒãƒ«ï¼šå…¥åŠ› â”€â”€â”€ -->

  <div class="panel-left">
    <div class="panel-header">
      <h1>âš¡ æ®µå‰²ã‚Šè¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
      <p>ç·šã®é•·ã•ã‚’æŒ‡å®šã—ãŸæ®µæ•°ã«åˆ†å‰²ã—ã¾ã™</p>
    </div>

```
<div class="scroll-area">

  <!-- å…¥åŠ›ã‚«ãƒ¼ãƒ‰ -->
  <div class="card">
    <div class="card-title">å…¥åŠ›</div>

    <div class="section-label">â–¸ åŸºæœ¬è¨­å®š</div>

    <div class="field">
      <div class="field-top">
        <label>å…¨ä½“ã®é•·ã•</label>
        <div class="num-wrap">
          <input type="number" id="totalLen" value="200" min="10" max="2000" step="1">
          <span class="unit">mm</span>
        </div>
      </div>
      <input type="range" id="totalLenR" min="10" max="2000" step="1" value="200">
    </div>

    <div class="field">
      <div class="field-top">
        <label>åˆ†å‰²ã™ã‚‹æ®µæ•°</label>
        <div class="num-wrap">
          <input type="number" id="numSeg" value="8" min="2" max="30" step="1">
          <span class="unit">æ®µ</span>
        </div>
      </div>
      <input type="range" id="numSegR" min="2" max="30" step="1" value="8">
    </div>

    <div class="field">
      <div class="field-top">
        <label>ä¸‹ç«¯ã®å¹…</label>
        <div class="num-wrap">
          <input type="number" id="widthBottom" value="100" min="1" max="500" step="1">
          <span class="unit">mm</span>
        </div>
      </div>
      <input type="range" id="widthBottomR" min="1" max="500" step="1" value="100">
    </div>

    <div class="field">
      <div class="field-top">
        <label>ä¸Šç«¯ã®å¹…</label>
        <div class="num-wrap">
          <input type="number" id="widthTop" value="20" min="0" max="500" step="1">
          <span class="unit">mm</span>
        </div>
      </div>
      <input type="range" id="widthTopR" min="0" max="500" step="1" value="20">
    </div>

    <div class="section-label">â–¸ ãã³ã‚Œè¨­å®š</div>
    <div class="btn-row">
      <button class="tog-btn active" id="btnWaistNone">ãã³ã‚Œãªã—</button>
      <button class="tog-btn"        id="btnWaistOn">ãã³ã‚Œã‚ã‚Š</button>
    </div>

    <div id="waistInputs" style="display:none">
      <div class="field">
        <div class="field-top">
          <label>ãã³ã‚Œä½ç½®ï¼ˆä¸‹ã‹ã‚‰ä½•æ®µç›®ï¼‰</label>
          <div class="num-wrap">
            <input type="number" id="waistSeg" value="3" min="1" max="29" step="1">
            <span class="unit">æ®µ</span>
          </div>
        </div>
        <input type="range" id="waistSegR" min="1" max="29" step="1" value="3">
      </div>
      <div class="field">
        <div class="field-top">
          <label>ãã³ã‚Œã®å¹…</label>
          <div class="num-wrap">
            <input type="number" id="waistWidth" value="15" min="1" max="500" step="1">
            <span class="unit">mm</span>
          </div>
        </div>
        <input type="range" id="waistWidthR" min="1" max="500" step="1" value="15">
      </div>
    </div>
  </div>

  <!-- å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ -->
  <div class="card">
    <div class="card-title">é–“éš”ã®å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³</div>
    <div class="btn-row">
      <button class="tog-btn"        id="btnRatio">ç­‰æ¯”ï¼ˆè‡ªç„¶ãªç¸®ã¿ï¼‰</button>
      <button class="tog-btn active" id="btnLinear">ç­‰å·®ï¼ˆå‡ç­‰ã«ç¸®å°ï¼‰</button>
    </div>
    <div class="hint" id="modeHint">æ®µã”ã¨ã«ä¸€å®šã®é•·ã•ãšã¤å‡ç­‰ã«å°ã•ããªã‚Šã¾ã™ã€‚</div>

    <div id="ratioInput" style="display:none">
      <div class="field">
        <div class="field-top">
          <label>ç¸®å°æ¯”ç‡</label>
          <div class="num-wrap">
            <input type="number" id="ratio" value="0.85" min="0.50" max="0.99" step="0.01">
            <span class="unit"></span>
          </div>
        </div>
        <input type="range" id="ratioR" min="50" max="99" step="1" value="85">
        <div class="hint">ä¸Šã®æ®µ = ä¸‹ã®æ®µ Ã— æ¯”ç‡ï¼ˆ0.85 â†’ 85%ï¼‰</div>
      </div>
    </div>

    <div id="linearInput">
      <div class="field">
        <div class="field-top">
          <label>æœ€ä¸Šæ®µ Ã· æœ€ä¸‹æ®µ</label>
          <div class="num-wrap">
            <input type="number" id="linearRatio" value="0.40" min="0.10" max="0.90" step="0.01">
            <span class="unit"></span>
          </div>
        </div>
        <input type="range" id="linearRatioR" min="10" max="90" step="1" value="40">
        <div class="hint">0.4 â†’ æœ€ä¸Šæ®µã¯æœ€ä¸‹æ®µã® 40% ã®é•·ã•</div>
      </div>
    </div>
  </div>

  <!-- çµæœ -->
  <div class="card">
    <div class="card-title">è¨ˆç®—çµæœï¼ˆä¸‹ã‹ã‚‰é †ï¼‰</div>
    <div class="error" id="errorMsg">å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
    <div class="seg-list" id="segList"></div>
    <div class="total-row">åˆè¨ˆ<span id="totalDisplay">â€”</span> mm</div>
  </div>

</div><!-- /scroll-area -->
```

  </div><!-- /panel-left -->

  <!-- â”€â”€â”€ å³ãƒ‘ãƒãƒ«ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€â”€ -->

  <div class="panel-right">
    <div class="preview-label">Preview</div>
    <canvas id="cv" width="540" height="1600"></canvas>
    <button class="save-btn" id="saveBtn">ğŸ“¥ PNG ä¿å­˜</button>
  </div>

</div><!-- /layout -->

<script>
  let mode     = 'linear';
  let hasWaist = false;

  // â”€â”€ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼â†”æ•°å€¤ åŒæœŸï¼ˆæ•´æ•°ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [
    ['totalLen',    'totalLenR'],
    ['numSeg',      'numSegR'],
    ['widthBottom', 'widthBottomR'],
    ['widthTop',    'widthTopR'],
    ['waistSeg',    'waistSegR'],
    ['waistWidth',  'waistWidthR'],
  ].forEach(([nid, rid]) => {
    const n = document.getElementById(nid);
    const r = document.getElementById(rid);
    n.addEventListener('input', () => { r.value = n.value; calc(); });
    r.addEventListener('input', () => { n.value = r.value; calc(); });
  });

  // â”€â”€ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼â†”æ•°å€¤ åŒæœŸï¼ˆå°æ•°Ã—100ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [
    ['ratio',       'ratioR'],
    ['linearRatio', 'linearRatioR'],
  ].forEach(([nid, rid]) => {
    const n = document.getElementById(nid);
    const r = document.getElementById(rid);
    n.addEventListener('input', () => { r.value = Math.round(parseFloat(n.value) * 100); calc(); });
    r.addEventListener('input', () => { n.value = (parseInt(r.value) / 100).toFixed(2); calc(); });
  });

  // â”€â”€ ãã³ã‚Œãƒœã‚¿ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('btnWaistNone').addEventListener('click', () => {
    hasWaist = false;
    document.getElementById('btnWaistNone').classList.add('active');
    document.getElementById('btnWaistOn').classList.remove('active');
    document.getElementById('waistInputs').style.display = 'none';
    calc();
  });
  document.getElementById('btnWaistOn').addEventListener('click', () => {
    hasWaist = true;
    document.getElementById('btnWaistOn').classList.add('active');
    document.getElementById('btnWaistNone').classList.remove('active');
    document.getElementById('waistInputs').style.display = '';
    calc();
  });

  // â”€â”€ å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒœã‚¿ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('btnRatio').addEventListener('click', () => {
    mode = 'ratio';
    document.getElementById('btnRatio').classList.add('active');
    document.getElementById('btnLinear').classList.remove('active');
    document.getElementById('ratioInput').style.display = '';
    document.getElementById('linearInput').style.display = 'none';
    document.getElementById('modeHint').textContent = 'ä¸Šã®æ®µãŒä¸‹ã®æ®µã®ä¸€å®šæ¯”ç‡ã§å°ã•ããªã‚Šã¾ã™ã€‚';
    calc();
  });
  document.getElementById('btnLinear').addEventListener('click', () => {
    mode = 'linear';
    document.getElementById('btnLinear').classList.add('active');
    document.getElementById('btnRatio').classList.remove('active');
    document.getElementById('ratioInput').style.display = 'none';
    document.getElementById('linearInput').style.display = '';
    document.getElementById('modeHint').textContent = 'æ®µã”ã¨ã«ä¸€å®šã®é•·ã•ãšã¤å‡ç­‰ã«å°ã•ããªã‚Šã¾ã™ã€‚';
    calc();
  });

  // â”€â”€ è¨ˆç®— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function calc() {
    const total = parseFloat(document.getElementById('totalLen').value);
    const n     = Math.min(30, Math.max(2, parseInt(document.getElementById('numSeg').value) || 2));
    const errEl = document.getElementById('errorMsg');

    if (!total || total <= 0) { errEl.style.display = 'block'; return; }
    errEl.style.display = 'none';

    // ãã³ã‚Œã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ€å¤§å€¤ã‚’æ®µæ•°ã«åˆã‚ã›ã‚‹
    const wsR = document.getElementById('waistSegR');
    const wsN = document.getElementById('waistSeg');
    wsR.max = n - 1;
    if (parseInt(wsN.value) >= n) { wsN.value = n - 1; wsR.value = n - 1; }

    let heights = [];
    if (mode === 'ratio') {
      const r = parseFloat(document.getElementById('ratio').value) || 0.85;
      if (r >= 1 || r <= 0) return;
      const a = total * (1 - r) / (1 - Math.pow(r, n));
      for (let i = 0; i < n; i++) heights.push(a * Math.pow(r, i));
    } else {
      const lr = parseFloat(document.getElementById('linearRatio').value) || 0.4;
      const a  = total / (n * (1 - (1 - lr) / 2));
      const d  = a * (1 - lr) / (n - 1);
      for (let i = 0; i < n; i++) heights.push(a - d * i);
    }

    // ãƒ†ãƒ¼ãƒ–ãƒ«
    const list = document.getElementById('segList');
    list.innerHTML = '';
    const maxH = heights[0];
    let sum = 0;
    heights.forEach((h, i) => {
      sum += h;
      const div = document.createElement('div');
      div.className = 'seg-item';
      div.innerHTML = `
        <div class="seg-label">ç¬¬${i+1}æ®µç›®</div>
        <div class="seg-value">${h.toFixed(2)}</div>
        <div class="seg-unit">mm</div>
        <div class="seg-bar-wrap"><div class="seg-bar" style="width:${(h/maxH*100).toFixed(0)}%"></div></div>
      `;
      list.appendChild(div);
    });
    document.getElementById('totalDisplay').textContent = sum.toFixed(2);

    drawPreview(heights, n);
  }

  // â”€â”€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function drawPreview(heights, n) {
    const cv  = document.getElementById('cv');
    const ctx = cv.getContext('2d');
    const pw  = cv.width, ph = cv.height;
    ctx.clearRect(0, 0, pw, ph);

    const pad    = 30;
    const total  = heights.reduce((a, b) => a + b, 0);
    const scaleY = (ph - pad * 2) / total;

    const wBottom  = parseFloat(document.getElementById('widthBottom').value) || 100;
    const wTop     = parseFloat(document.getElementById('widthTop').value)    || 20;
    const waistWmm = hasWaist ? (parseFloat(document.getElementById('waistWidth').value) || 15) : 0;
    const waistAt  = hasWaist
      ? Math.min(n - 1, Math.max(1, parseInt(document.getElementById('waistSeg').value) || 3))
      : 0;

    // å„å¢ƒç•Œã®Yåº§æ¨™ã‚’äº‹å‰è¨ˆç®—
    const boundaryY = [ph - pad];
    for (let i = 0; i < n; i++) {
      boundaryY.push(boundaryY[i] - heights[i] * scaleY);
    }
    const totalPx = ph - pad * 2;

    // Yåº§æ¨™ã‹ã‚‰å¹…(mm)ã‚’è¿”ã™
    function widthAtY(y) {
      const t = (ph - pad - y) / totalPx; // 0=æœ€ä¸‹ç«¯, 1=æœ€ä¸Šç«¯
      if (!hasWaist) {
        return wBottom + (wTop - wBottom) * t;
      }
      const tWaist = (ph - pad - boundaryY[waistAt]) / totalPx;
      if (t <= tWaist) {
        return wBottom + (waistWmm - wBottom) * (t / tWaist);
      } else {
        return waistWmm + (wTop - waistWmm) * ((t - tWaist) / (1 - tWaist));
      }
    }

    const wMax   = Math.max(wBottom, wTop, hasWaist ? waistWmm : 0);
    const wScale = (pw - pad * 2) / wMax;
    const cx = pw / 2;
    let y = ph - pad;

    heights.forEach((h, i) => {
      const segH = h * scaleY;
      const bw   = widthAtY(boundaryY[i])     * wScale;
      const tw   = widthAtY(boundaryY[i + 1]) * wScale;

      ctx.beginPath();
      ctx.moveTo(cx - bw/2, y);
      ctx.lineTo(cx + bw/2, y);
      ctx.lineTo(cx + tw/2, y - segH);
      ctx.lineTo(cx - tw/2, y - segH);
      ctx.closePath();
      ctx.strokeStyle = '#1a6b4a';
      ctx.lineWidth = 8;
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(cx - bw/2, y);
      ctx.lineTo(cx + tw/2, y - segH);
      ctx.moveTo(cx + bw/2, y);
      ctx.lineTo(cx - tw/2, y - segH);
      ctx.strokeStyle = '#aacfbe';
      ctx.lineWidth = 4;
      ctx.stroke();

      y -= segH;
    });
  }

  // â”€â”€ ä¿å­˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('saveBtn').addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'tower-preview.png';
    link.href = document.getElementById('cv').toDataURL('image/png');
    link.click();
  });

  calc();
</script>

</body>
</html>
